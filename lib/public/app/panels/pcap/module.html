<div ng-controller='pcap' ng-init="init()">

  <style>
    .table-doc-table {
      margin-left: 0px !important;
      overflow-y: auto;
    }
    .table-sidebar {
      width: 200px;
      display: table-cell;
      padding-right: 10px;
    }
    .table-main {
      width: 100%;
      display: table-cell;
    }
    .table-container {
      display: table;
      height: 100px;
      width: 100%;
      table-layout: fixed;
    }
    .table-fieldname {
      white-space: nowrap;
    }

    .table-fieldname a {
      word-wrap:break-word;
      white-space: normal;
    }

    .table-details {
      table-layout: fixed;
    }

    .table-details-field {
      width: 200px;
    }

    .table-details-action {
      width: 60px;
      text-align: center;
    }

    .table-details-value {
    }

    .table-field-value {
      white-space: pre-wrap;
    }

    span.hilite {
        background: yellow;
    }

    .pcap-raw {
        background: #FCFCFC;
        color: #5F5F5F;
    }

    .uppercase {
        text-transform: uppercase;
    }

    span, td, th {
        font-size: 13px;
    }

    .main-row {
        cursor: pointer;
    }

    .main-row:hover {
        background-color: #7E7E7E ;
    }

    .extra-row {
        background-color: #474747 !important;
    }
    ul{
        list-style-type: none;
    }

    .highlight {
      background-color: blue;
    }
    .newline { clear:both !important;}
    .padright { margin-left: 16px !important;}

  </style>



<div class="table-container">

    <table class="table table-bordered table-condensed table-details table-striped" ng-style="panel.style">
    <thead>
      <tr>
        <td>label</td>
      <tr>
    </thead>
    <tbody bindonce ng-repeat="packet in packet_data.pdml.packet">
        <tr ng-click="$parent.drilldown = packet"><td><span>{{$index}}</span></td><td>{{packet.proto[3].field[10].$.show}}</td>
<td>{{packet.proto[3].field[14].$.show}}</td><td>{{packet.proto[4].field[0].$.showname}}</td>
        </tr>
    </tbody>
    </table>

      <table class="">
       <thead></thead>
      <tbody bindonce ng-repeat="event in data| slice:panel.offset:panel.offset+panel.size" ng-class-odd="'odd'" class="extra-row" ng-show="activePosition == $index">
          <tr bindonce ng-repeat="prot in event.proto" class="main-row">
            <td><div ng-click="prot.isVisible = !prot.isVisible">{{protShowname(prot.$)}}</div>
            <div>
              <ul ng-show="prot.isVisible">
                <li ng-repeat="fieldval in prot.field" ng-click="fieldBytes(fieldval)">
                    <p>{{fieldvalShowname(fieldval)}}</p>
                </li>
            </ul>
            </div>
            </td>
          </tr>
      </tbody>
      </table>

  </table>
<!--   <div ng-repeat="packet in packet_data.pdml.packet">
      <span ng-click="$parent.drilldown = packet">
        {{$index}}
      </span>
    </div> -->
  
    <div packet="drilldown"></div>
</div>

  <script type="text/ng-template" id="packet.html">
    <div ng-repeat="proto in packet.proto">
      <span ng-class="{'icon-chevron-down': expanded, 'icon-chevron-right': !expanded}" ng-click="expanded = select(proto) || !expanded"></span>
      <span ng-class="{highlight: selectedData.uid === proto.$.uid}" ng-click="expanded = select(proto) || !expanded">
        {{ proto.$.showname }}
      </span>

      <div ng-if="expanded" style="margin-left:50px">
        <div ng-repeat="f in proto.field">
          <span ng-class="{highlight: $parent.selectedData.uid === f.$.uid}" ng-click="select_field(f)">
            {{ f.$.showname }}
          </span>
        </div>
      </div>
    </div>
    {{ selectedData }}
    <div hex-bytes bytes="packet.hexPacket" selected-bytes="selectedBytes" selected-data="selectedData"></div>
  </script>

  <script type="text/ng-template" id="hexBytes.html">
    Position: {{selectedBytes.pos}}<br/>
    Size: {{selectedBytes.size}}<br/><br/>
    <span ng-repeat="b in bytes track by $index">
      <span class="byte" ng-class="{highlight: selectedBytes.pos <= $index && (selectedBytes.pos|num)+(selectedBytes.size|num) > $index, newline:$index%16==0, padright:($index+8)%16==0}" ng-click="selectByte($index)" style="float:left; padding:4px;">
        {{ b }}
      </span>
    </span>
  </script>

  <!--<p ng-style="panel.style" ng-bind-html-unsafe="panel.content | striphtml | newlines"></p>-->
  <markdown ng-show="ready && panel.mode == 'markdown'">
    {{panel.content}}
  </markdown>
  <p ng-show="panel.mode == 'pcap'" ng-style='panel.style' ng-bind-html="panel.content | striphtml | newlines">
  </p>
  <p ng-show="panel.mode == 'html'" ng-bind-html="panel.content">
  </p>
</div>
