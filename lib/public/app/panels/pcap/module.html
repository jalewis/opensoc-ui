<div ng-controller='pcap' ng-init="init()">

  <style>
    .table-doc-table {
      margin-left: 0px !important;
      overflow-y: auto;
    }
    .table-sidebar {
      width: 200px;
      display: table-cell;
      padding-right: 10px;
    }
    .table-main {
      width: 100%;
      display: table-cell;
    }
    .table-container {
      display: table;
      height: 100px;
      width: 100%;
      table-layout: fixed;
    }
    .table-fieldname {
      white-space: nowrap;
    }

    .table-fieldname a {
      word-wrap:break-word;
      white-space: normal;
    }

    .table-details {
      table-layout: fixed;
    }

    .table-details-field {
      width: 200px;
    }

    .table-details-action {
      width: 60px;
      text-align: center;
    }

    .table-details-value {
    }

    .table-field-value {
      white-space: pre-wrap;
    }

    span.hilite {
        background: yellow;
    }

    .pcap-raw {
        background: #FCFCFC;
        color: #5F5F5F;
    }

    .uppercase {
        text-transform: uppercase;
    }

    span, td, th {
        font-size: 13px;
    }
  </style>



<div class="table-container">
  <table class="table table-bordered table-condensed table-details table-striped" ng-style="panel.style">
    <!-- <thead ng-show="panel.header"> -->
    <thead>
      <tr>
        <th>No.</th>
        <th>Time</th>
        <th>Source</th>
        <th>Destination</th>
        <th>Protocol</th>
        <th>Length</th>
        <th>Info</th>
      </tr>
    </thead>
      <tbody bindonce ng-repeat="event in data| slice:panel.offset:panel.offset+panel.size" ng-class-odd="'odd'">
          <tr ng-click="toggle_details(event)" class="pointer">
            <td bo-text="event.proto[0].field[0].$.value"></td>
            <td bo-text="event.proto[1].field[3].$.show"></td>
            <td bo-text="event.proto[3].field[10].$.show"></td>
            <td bo-text="event.proto[3].field[15].$.show"></td>
            <td><span bo-text="event.proto[4].$.name" class="uppercase"></span>v<span bo-text="event.proto[4].field[0].$.show"></span></td>
            <td bo-text="event.proto[0].field[1].$.show"></td>
            <td bo-text="event.proto[4].field[1].$.showname"></td>
          </tr>
          <tr ng-if="event.details">
            <td colspan="4"><!-- Change to colspan of panel.fields.length -->
                <table>
                    <tr ng-repeat="val in event.field">
                        <td ng-click="highlight_text()">{{val.$.name}}</td>
                        <td>{{val.$.showname}}</td>
                        <td>{{val.$.size}}</td>
                        <td>{{val.$.pos}}</td>
                    </tr>
                </table>
            </td>
          </tr>
      </tbody>
  </table>

<!-- PCAP Table -->
<div class="table-container">
  <table class="table table-bordered table-condensed table-details table-striped" ng-style="panel.style">
    <!-- <thead ng-show="panel.header"> -->
    <thead>
      <tr>
        <th>Levels 1 - 4</th>
      </tr>
    </thead>
      <tbody bindonce ng-repeat="event in data| slice:panel.offset:panel.offset+panel.size" ng-class-odd="'odd'">
          <tr ng-click="toggle_details(event.proto[1])" class="pointer">
            <td><span class="toggle-arrow">></span> <i class="fa fa-chevron-right"></i>{{event.proto[1].$.showname}}</td>
          </tr>
          <tr ng-if="event.proto[1].details">
            <td>
                <table>
                    <tr ng-repeat="val in event.proto[1].field" ng-click="highlight_bytes_below(val.$.pos, val.$.size)">
                        <td>{{val.$.showname}}</td>
                        <td>{{val.$.size}}</td>
                        <td>{{val.$.pos}}</td>
                    </tr>
                </table>
            </td>
          </tr>

          <tr ng-click="toggle_details(event.proto[2])" class="pointer">
            <td bo-text="event.proto[2].$.showname"></td>
          </tr>
          <tr ng-if="event.proto[2].details">
            <td>
                <table>
                    <tr ng-repeat="val in event.proto[2].field" ng-click="highlight_bytes_below(val.$.pos, val.$.size)">
                        <td>{{val.$.showname}}</td>
                        <td>{{val.$.size}}</td>
                        <td>{{val.$.pos}}</td>
                    </tr>
                </table>
            </td>
          </tr>
          <tr ng-click="toggle_details(event.proto[3])" class="pointer">
            <td bo-text="event.proto[3].$.showname"></td>
          </tr>
          <tr ng-if="event.proto[3].details">
            <td>
                <table>
                    <tr ng-repeat="val in event.proto[3].field" ng-click="highlight_bytes_below(val.$.pos, val.$.size)">
                        <td>{{val.$.showname}}</td>
                        <td>{{val.$.size}}</td>
                        <td>{{val.$.pos}}</td>
                    </tr>
                </table>
            </td>
          </tr>
          <tr ng-click="toggle_details(event.proto[4])" class="pointer">
            <td bo-text="event.proto[4].$.showname"></td>
          </tr>
          <tr ng-if="event.proto[4].details">
            <td>
                <table>
                    <tr ng-repeat="val in event.proto[4].field" ng-click="highlight_bytes_below(val.$.pos, val.$.size)">
                        <td>{{val.$.showname}}</td>
                        <td>{{val.$.size}}</td>
                        <td>{{val.$.pos}}</td>
                    </tr>
                </table>
            </td>
          </tr>
      </tbody>
  </table>

  <table class="table table-bordered table-condensed table-details table-striped" ng-style="panel.style">
    <!-- <thead ng-show="panel.header"> -->
    <thead>
      <tr>
        <th>Hex Bytes</th>
      </tr>
    </thead>
      <tbody>
          <tr>
            <td><span bindonce ng-repeat="byte in hexData" ng-click="hightlight_bytes(byte.parent)" ng-class="byte.parent" class="byte"><span class="{{byte.parent}} byte">{{byte.byte}}</span> </span></td>
          </tr>
      </tbody>
  </table>
</div>

  <!--<p ng-style="panel.style" ng-bind-html-unsafe="panel.content | striphtml | newlines"></p>-->
  <markdown ng-show="ready && panel.mode == 'markdown'">
    {{panel.content}}
  </markdown>
  <p ng-show="panel.mode == 'pcap'" ng-style='panel.style' ng-bind-html="panel.content | striphtml | newlines">
  </p>
  <p ng-show="panel.mode == 'html'" ng-bind-html="panel.content">
  </p>
</div>
